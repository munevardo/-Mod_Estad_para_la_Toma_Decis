---
title: "Estadistica_trabajo_3"
author: "jose_munevar y Meidy Lizeth Moreno"
date: "2025-09-22"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)



library(readr)
library(dplyr)
library(plotly)
library(sf) # Para trabajar con datos espaciales
library(leaflet) # Para mapas interactivos
library(htmlwidgets)
library(skimr)
library(GGally)
library(pROC)

library(paqueteMODELOS)
data("rotacion")

```

```{r}
library(paqueteMODELOS)
library(dplyr)
data("rotacion")
glimpse(rotacion)
```
<h1>Análsis exploratorio de datos</h1>

```{r}
summary(rotacion)
```


```{r}
head(rotacion)
```

```{r}
tail(rotacion)
```

```{r}
skimr::skim(rotacion)
```


<h2>Identificación de duplicados</h2>

```{r}

# Contar el número total de filas completamente duplicadas
numero_duplicados <- sum(duplicated(rotacion))

print(paste("Se encontraron", numero_duplicados, "filas completamente duplicadas."))

```

<h2>Identifcación de columnas en y celdas vacías</h2>

```{r}
# Total de NA en el dataset
sum(is.na(rotacion))

# NA por columna
colSums(is.na(rotacion))

# Filas con NA
rotacion[!complete.cases(rotacion), ]


```

```{r}

# Total de cadenas vacías
sum(rotacion == "", na.rm = TRUE)

# Por columna
sapply(rotacion, function(x) sum(x == "", na.rm = TRUE))


```



```{r}

# Inf o -Inf
sum(is.infinite(as.matrix(rotacion)))

# NaN
sum(is.nan(as.matrix(rotacion)))


```
Al parecer el Datframe está bastante integro, no presentar datos faltantes.

<h2>Definición de las hipótesis<h2>

<h3>1. Variables categóricas</h3>

<ul>
<li><strong>Departamento/Área:</strong> La rotación puede variar según el área de trabajo (hipótesis: algunos departamentos tienen mayor desgaste).</li>

<li><strong>Nivel educativo: </strong>Empleados con menor nivel educativo podrían tener más rotación por mejores oportunidades externas o menor estabilidad.</li>

<li><strong>Estado civil:</strong> Personas solteras podrían cambiar más de empleo que las casadas (hipótesis sobre estabilidad personal).</li>

</ul>

<h3>2. Variables cuantitativas</h3>

<ul>
<li><strong>Edad:</strong> Podría haber una relación no lineal: jóvenes rotan más, adultos medios menos, cercanos a jubilación otra vez más.</li>

<li><strong>Años de experiencia en la empresa:</strong> Mayor antigüedad suele estar asociada con menor rotación.</li>

<li><strong>Ingreso Mensual: </strong>Un salario más bajo puede estar vinculado con mayor rotación.</li>
</ul>

<h2>1. Selección de variables</h2>
<h3>Variables Cuantitativas</h3>

```{r}

boxplot(Edad ~ Rotación, 
        data = rotacion,
        col = c("skyblue", "lightgreen"),
        main = "Distribución de Edad según Rotación",
        xlab = "Rotación",
        ylab = "Edad")

```
<p>En este gráfico podemos comparar el grupo con rotación contra el grupo sin rotación en verde, en el grupo con rotación tenemos una media alrededor de <strong>35 años</strong>,con un rango intercuartil entre 31 y 42 años; por otro lado en el grupo con rotación en caja verde una media cercana de 32-33 años, ligeramente más baja con un rango intercuartil entre 29 y 38 años y algunos outliers cerca de 55-67 años. Esto nos muestra que el grupo con rotación suele ser más joven, en promedio que el que tiene rotación, además se puede apoyar nuestra hipótesis al ver que a menor edad hay una mayor edad de rotación.</p>

```{r}

boxplot(Ingreso_Mensual ~ Rotación, 
        data = rotacion,
        col = c("skyblue", "lightgreen"),
        main = "Distribución de Edad según Rotación",
        xlab = "Rotación",
        ylab = "Ingreso Mensual")

```
<p>En este gráfico podemos identificar que la media de ingresos de las personas con rotación está cerca de los 5000 USD, mientras que la media de los empleados que rotan está por los 4000 USD más bajo. los empleados con mayores ingresos suelen quedarse en la compañía, esto se ve reforzado por los rangos intercuartiles, que los empleados que no rotan está entre 3,500 y 9000 USD mientras que los rangos de los empleados con rotación están entre 3000 y 6000 USD, sin embargo hay casos en donde algunos outliers aún con grandes ingresos deciden abandonar la compañía.</p>

```{r}

boxplot(Años_Experiencia ~ Rotación, 
        data = rotacion,
        col = c("skyblue", "lightgreen"),
        main = "Distribución de Años de Experiencia según Rotación",
        xlab = "Rotación",
        ylab = "Ingreso Mensual",
        yaxt = "n'")

# Personalizamos el eje Y con saltos de 1 en 1
axis(side = 2, at = seq(0, max(rotacion$Años_Experiencia, na.rm = TRUE), by = 1))
```
<p>En este gráfico podemos identificar la relación entre rotación  y años de experiencia la media entre los empleados que no rotan es 8 años, mientras que la media entre los empleados que si lo hacen es apenas 5 años, así mismo el ranto intercuartil de los empleados que si rotan es entre 5 y 12 años y los que si lo hacen es de 3 y 8 años aquí tenemos una relación esperada se observa que los empleados con menos años de experiencia tienden a rotar más.</p>

<h3>Variables Cuantitativas</h3>

```{r}

# Edad según Departamento
boxplot(Edad ~ Departamento, data = rotacion,
        col = "skyblue",
        main = "Distribución de Edad según Departamento",
        xlab = "Departamento", ylab = "Edad")
```
<p>De este gráfico podemos identificar que recursos humanos, tiende a tener empleados un poco mayores en promedio que los otros departamentos. Ventas agrupa perfiles más jóvenes, lo que puede asociarse con mayor rotación o menor estabilidad, lo que pudimos ver en nuestra hipotesis inicial, IyD está en un punto intermedio, con un rango similar al de RH pero con mediana más baja.</p>

```{r}

# Ingreso mensual según Nivel educativo
boxplot(Ingreso_Mensual ~ Cargo, data = rotacion,
        col = "lightgreen",
        main = "Distribución de Ingreso según Nivel Educativo",
        xlab = "Cargo", ylab = "Ingreso Mensual")

```
<p>Existe una relación clara y positiva entre el nivel de responsabilidad del cargo y el ingreso mensual. Los cargos de Director de Investigación y Gerente tienen los ingresos más altos y la menor variabilidad salarial, lo que refleja una estructura de compensación más definida para roles de liderazgo.</p>

```{r}

# Años de experiencia según Estado Civil
boxplot(Años_Experiencia ~ Estado_Civil, data = rotacion,
        col = "lightpink",
        main = "Distribución de Experiencia según Estado Civil",
        xlab = "Estado Civil", ylab = "Años de Experiencia")


```
<p>Casados y divorciados muestran más experiencia acumulada en comparación con los solteros, Solteros tienen más variabilidad: muchos con poca experiencia y unos pocos con mucha, lo que puede reflejar diferentes etapas en su carrera. Esto puede estar alineado con la hipótesis: Personas casadas/divorciadas suelen tener mayor estabilidad laboral (y más años acumulados), Personas solteras tienden a estar en etapas más tempranas de su carrera, por lo que muestran menos experiencia en general y podrían tener más rotación.</p>

<h2>2. Analisis Univariado</h2>
<p>Variables categoricas</p>
```{r}
# Variables categóricas
# Frecuencia de la variable de rotación
rotacion %>%
  count(Rotación) %>%
  mutate(Proporción = n / sum(n))

# Frecuencia de la variable Departamento
rotacion %>%
  count(Departamento) %>%
  mutate(Proporción = n / sum(n))

# Frecuencia de la variable Cargo
rotacion %>%
  count(Cargo) %>%
  mutate(Proporción = n / sum(n))

# Frecuencia de la variable Horas_Extra
rotacion %>%
  count(Horas_Extra) %>%
  mutate(Proporción = n / sum(n))

```
<ul>

1. Variables Categóricas

<li>Rotación: Esta es la variable de interés principal. Es una variable binaria con las categorías "Si" y "No". Un análisis de su distribución muestra la proporción de empleados que han abandonado la empresa</li>
<br>
<li>Distribución: Hay 1470 observaciones en total. La mayoría de los empleados no han rotado (83.9%), mientras que una porción menor (16.1%) sí lo ha hecho.</li>
<br>
<li>Departamento: Esta variable muestra la distribución de empleados por departamento.Distribución: El departamento de Investigación y Desarrollo (IyD) tiene la mayor cantidad de empleados (653), seguido por Ventas (446) y, en menor medida, Recursos Humanos (63).</li>
<li>Cargo: Esta variable desglosa los roles dentro de la compañía.Distribución: Los roles más comunes son el de Ejecutivo de Ventas (32.3%) y el de Investigador Científico (19.8%). El rol de Director de Investigación tiene la menor representación (2.7%).</li>
<br>
<li>Horas_Extra:La mayoría de los empleados (71.8%) no trabaja horas extra, mientras que el 28.2% restante sí lo hace.</li>
<br>
<li>Viaje de Negocios: Muestra la frecuencia con la que los empleados viajan por trabajo.Distribución: La categoría "Raramente" es la más frecuente (70.9%), lo que sugiere que la mayoría de los empleados no viaja con frecuencia.</li>
</ul>


```{r}

# Variables cuantitativas
# Histograma de la Edad
hist(rotacion$Edad, main = "Distribución de la Edad", xlab = "Edad", col = "skyblue")

# Histograma del Ingreso_Mensual
hist(rotacion$Ingreso_Mensual, main = "Distribución del Ingreso Mensual", xlab = "Ingreso Mensual", col = "lightgreen")

# Histograma de la Antigüedad
hist(rotacion$Antigüedad, main = "Distribución de la Antigüedad", xlab = "Antigüedad", col = "salmon")

```
<ul>

1. Variables Categóricas
<li>Edad:La edad promedio es de 36.9 años, con una desviación estándar de 9.14 años. El 50% de los empleados tiene entre 30 y 43 años. El empleado más joven tiene 18 años y el mayor 60 años.</li>
<br>
<li>Ingreso_Mensual:El ingreso promedio es de $6,503 USD, con una desviación estándar considerable de $4,708 USD. La mediana es de $4,919 USD, lo que indica que la mitad de los empleados gana menos de esta cantidad. El ingreso mínimo es de $1,009 USD y el máximo de $19,999 USD.</li>
<br>
<li>Antigüedad:La antigüedad media es de 7 años, con una mediana de 5 años. La mayoría de los empleados ha estado en la empresa durante un período corto, aunque hay valores atípicos que llegan hasta los 40 años, lo que sugiere una alta retención en algunos casos.</li>
<br>
<li>Años_acargo_con_mismo_jefe:a media es de 4.12 años, con una mediana de 3 años, lo que indica que, en general, los empleados cambian de jefe con cierta frecuencia o tienen una antigüedad relativamente baja en el mismo puesto de supervisión.</li>
<br>
<li>Años_Experiencia: La media de experiencia es de 11.28 años, con una mediana de 10 años. Esto sugiere que la mayoría de los empleados de la empresa son trabajadores con experiencia en el mercado laboral.</li>
<br>
<li>Distancia_Casa:La distancia promedio es de 9.19 kilómetros, con una mediana de 7 kilómetros. Los valores varían desde 1 hasta 29 kilómetros, lo que indica una amplia dispersión en la ubicación de residencia de los empleados.</li>

</ul>


<h2>3. Analisis  Bivariado (relaciones con Rotación)</h2>
```{r}
# Boxplot: Edad vs. Rotación
boxplot(Edad ~ Rotación, data = rotacion,
        col = c("skyblue", "lightgreen"),
        main = "Distribución de Edad según Rotación",
        xlab = "Rotación",
        ylab = "Edad")

# Boxplot: Ingreso_Mensual vs. Rotación
boxplot(Ingreso_Mensual ~ Rotación, data = rotacion,
        col = c("skyblue", "lightgreen"),
        main = "Distribución de Ingreso Mensual según Rotación",
        xlab = "Rotación",
        ylab = "Ingreso Mensual")

# Boxplot: Años_Experiencia vs. Rotación
boxplot(Años_Experiencia ~ Rotación, data = rotacion,
        col = c("skyblue", "lightgreen"),
        main = "Distribución de Años de Experiencia según Rotación",
        xlab = "Rotación",
        ylab = "Años de Experiencia")
```

```{r}
# Convertir la variable de respuesta a factor y luego a numérico (0, 1)

rotacion <- rotacion %>%
  mutate(rotacion_numerica = ifelse(Rotación == "Si", 1, 0))

```

```{r}
covariables <- c("Edad", "Ingreso_Mensual", "Años_Experiencia",
                 "Departamento", "Estado_Civil", "Horas_Extra")
```

<h2>4. Estimación del Modelo de Regresión Logística</h2>

```{r}
# Ajustar el modelo de regresión logística
modelo_logistico <- glm(rotacion_numerica ~ Edad + Ingreso_Mensual + 
                          Años_Experiencia + Departamento + Estado_Civil + 
                          Horas_Extra,
                        data = rotacion,
                        family = binomial(link = "logit"))

summary(modelo_logistico)
```
```{r}

# Interpretar los coeficientes usando Odds Ratio (OR)
# Extraer los coeficientes del modelo y calcular exp(coeficientes)
or_values <- exp(coef(modelo_logistico))
or_table <- data.frame(OR = or_values,
p_value = summary(modelo_logistico)$coefficients[,4])

print("Tabla de Odds Ratios (OR) y p-valores:")
print(or_table)

```
<h3><strong>Interpretación de la Tabla </strong></h3>
<ul>
<li>Edad: Por cada año adicional de edad, el riesgo de rotación disminuye en un 2.1%. Aunque la relación es negativa, no es estadísticamente significativa (p > 0.05), lo que sugiere que la edad no es un predictor fuerte de la rotación en este modelo.</li>
<li>Ingreso_Mensual:Por cada dólar adicional en el salario mensual, el riesgo de rotación disminuye, aunque de manera muy leve. Este efecto es altamente significativo (p < 0.05), lo que confirma que el salario tiene una influencia, aunque pequeña, en la rotación.</li>
<li>Años_Experiencia:Por cada año adicional de experiencia laboral, la probabilidad de rotación disminuye en un 2.2%. Sin embargo, esta relación no es estadísticamente significativa (p > 0.05).</li>
<li>DepartamentoVentas:Un empleado del departamento de Ventas tiene casi 1.8 veces más probabilidades de rotar que un empleado del departamento de Investigación y Desarrollo (IyD), que es la categoría base. Esta diferencia es altamente significativa (p < 0.05).</li>
<li>Estado_CivilSoltero:Un empleado soltero tiene 2.3 veces más probabilidades de rotar que un empleado casado (categoría base). Esta relación es altamente significativa (p < 0.05).</li>
<li>Horas_ExtraSi:Un empleado que trabaja horas extra tiene 4.4 veces más probabilidades de rotar que un empleado que no lo hace. Este es el predictor más fuerte del modelo y es altamente significativo (p < 0.05).</li>
</ul>
<br>
<ul>
<h3><strong>Conclusiones</strong></h3>
<li>Horas_Extra: Es el factor más influyente. Los empleados que hacen horas extra tienen más de cuatro veces el riesgo de rotar.</li>
<li>Estado_Civil: Ser soltero aumenta significativamente el riesgo de rotación en comparación con los empleados casados.</li>
<li>Departamento: Los empleados del departamento de Ventas tienen un riesgo de rotación casi 1.8 veces mayor que los de IyD.</li>
<li>Ingreso_Mensual: Un salario más alto reduce ligeramente el riesgo de rotación.</li>
<li>Las variables Edad y Años_Experiencia no son predictores estadísticamente significativos en este modelo, a pesar de que los odds ratios sugieren una relación negativa.</li>
</ul>

<h2> 5. Evaluación</h2>

```{r}
# calcular las probabilidades predichas por el modelo

predicciones <- predict(modelo_logistico, type  = "response")


# creación del objeto ROC

roc_obj <- roc(rotacion$rotacion_numerica, predicciones)

# Intenta trazar la curva ROC con la configuración más básica
plot(roc_obj)

# Imprimir el valor del AUC
print("El valor del AUC es:")
print(auc(roc_obj))

```
<p>Según mi curva ROC y la interpretación de mi AUC, que resultó ser 0,76, se considera este como un modelo bastante aceptable siendo suficientemente capaz de predecir si los empleados abandonarán o se quedarán en la compañía</p>


<h2>6. Predicciones</h2>

```{r}
# 1. Definir un individuo hipotético (nuevo data.frame)
# Asegúrate de que las variables categóricas tengan los mismos niveles que los datos de entrenamiento
nuevo_empleado <- data.frame(
  Edad = 28,
  Ingreso_Mensual = 3500,
  Años_Experiencia = 3,
  Departamento = "Ventas",
  Estado_Civil = "Soltero",
  Horas_Extra = "Si"
)

# Para que las variables categóricas sean reconocidas, se convierten a factor
nuevo_empleado$Departamento <- as.factor(nuevo_empleado$Departamento)
nuevo_empleado$Estado_Civil <- as.factor(nuevo_empleado$Estado_Civil)
nuevo_empleado$Horas_Extra <- as.factor(nuevo_empleado$Horas_Extra)

# 2. Realizar la predicción
# El argumento 'type = "response"' devuelve la probabilidad

probabilidad_rotacion <- predict(modelo_logistico, newdata = nuevo_empleado, type = "response")

# 3. Definir un punto de corte para la estrategia
punto_corte <- 0.5 # Puedes ajustar este valor según la necesidad de la empresa

# 4. Implementar la estrategia
if (probabilidad_rotacion >= punto_corte) {
  estrategia <- "Se recomienda una intervención. El empleado está en alto riesgo de rotar."
} else {
  estrategia <- "El empleado no parece estar en alto riesgo de rotar."
}

# 5. Imprimir los resultados
print(paste("La probabilidad de rotación para este empleado es:", round(probabilidad_rotacion, 4)))
print(paste("Estrategia recomendada:", estrategia))

# =========================================================================
# Ejemplo de salida:
# "La probabilidad de rotación para este empleado es: 0.65"
# "Estrategia recomendada: Se recomienda una intervención. El empleado está en alto riesgo de rotar."
```
<h2>7. Conclusiones</h2>






